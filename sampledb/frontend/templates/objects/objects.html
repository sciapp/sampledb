{% extends "base.html" %}

{% block title %}{{ _('Objects') }} — {{ service_name }}{% endblock %}

{% block stylesheets %}
  {{ super() }}
  <link rel="stylesheet" href="{{ fingerprinted_static('bootstrap-select/css/bootstrap-select.min.css') }}" />
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ fingerprinted_static('bootstrap-select/js/bootstrap-select.min.js') }}"></script>
  <script src="{{ fingerprinted_static('plotly/js/plotly-latest.min.js') }}"></script>
  <script src="{{ fingerprinted_static('sampledb/js/treepicker.js') }}"></script>
  {% if get_user_language(current_user).lang_code == 'de' %}
    <script src="{{ fingerprinted_static('plotly/js/plotly-locale-de.js') }}"></script>
    <script type="text/javascript">
      Plotly.setPlotConfig({locale: 'de'})
    </script>
  {% endif %}
  <script type="text/javascript">
    const object_ids_write_permission = {{ objects_with_write_permission | tojson }};
    let selected_object_ids = [];

    $('[data-toggle="tooltip"]').tooltip({ trigger: 'hover' });

    window.object_location_translations = { '{{ ENGLISH.lang_code }}': '',};
    window.languages = [
      {% for lang in all_languages %}
        {
          'id': '{{ lang.id }}',
          'name': '{{ lang.names | get_translated_text }}',
          'lang_code': '{{ lang.lang_code }}'
        },
      {% endfor %}
    ];


    $(document).ready(function() {
      let filter_origin_ids_picker = $('#filter_origin_ids');
      let filter_action_type_ids_picker = $('#filter_action_type_ids');
      let filter_action_ids_picker = $('#filter_action_ids');
      let filter_instrument_picker = $('#filter_instrument_ids');
      filter_origin_ids_picker.on('changed.bs.select', function() {
        let selected_sources = filter_origin_ids_picker.val();
        if (selected_sources.length === 0) {
          // enable all options
          filter_action_type_ids_picker.find('option').prop('disabled', false);
          filter_action_ids_picker.find('option').prop('disabled', false);
          filter_instrument_picker.find('option').prop('disabled', false);
        } else {
          // disable all options
          filter_action_type_ids_picker.find('option').prop('disabled', true);
          filter_action_ids_picker.find('option').prop('disabled', true);
          filter_instrument_picker.find('option').prop('disabled', true);
          // enable local default action types as they might be aliases for other action types
          filter_action_type_ids_picker.find('option[data-source="local"][value^="-"]').prop('disabled', false);
          // enable options for the selected sources
          for (const source of selected_sources) {
            filter_action_type_ids_picker.find('option[data-source="' + source + '"]').prop('disabled', false);
            filter_action_ids_picker.find('option[data-source="' + source + '"]').prop('disabled', false);
            filter_instrument_picker.find('option[data-source="' + source + '"]').prop('disabled', false);
          }
        }
        // refresh to update enabled/disabled options
        filter_action_type_ids_picker.selectpicker('refresh');
        filter_action_ids_picker.selectpicker('refresh');
        filter_instrument_picker.selectpicker('refresh');
        // render to update selected options
        filter_action_type_ids_picker.selectpicker('render');
        filter_action_ids_picker.selectpicker('render');
        filter_instrument_picker.selectpicker('render');
      });
      $(plotly_charts).each(function(index, element) {
        Plotly.newPlot(element[0], element[1]);
      });
      $('.selectpicker').each(function(_, element) {
        let selectpicker = $(element);
        selectpicker.selectpicker();
        // ensure options marked as selected will be selected again after page reload
        let selected_options = selectpicker.find('option[selected]');
        if (selected_options) {
          let selected_option_values = [];
          selected_options.each(function(_, option) {
            selected_option_values.push($(option).val());
          });
          selectpicker.selectpicker('val', selected_option_values);
        } else {
          selectpicker.selectpicker('val', null);
        }
      });

      $("#object-location").selectpicker('val', '-1');
      $("#object-responsible-user").selectpicker('val', '-1');

      $(".checkbox-select-child").prop('checked', false);

      $("#checkbox-select-overall").prop('checked', false);
      $("#checkbox-select-overall").prop('indeterminate', false);

    });

    function checkAllAvailableSelected() {
      return object_ids_write_permission.every(id => selected_object_ids.includes(id));
    }

    function checkSomeAvailableSelected() {
      return object_ids_write_permission.some(id => selected_object_ids.includes(id));
    }

    function isSelectionValid() {
        return selected_object_ids.every(id => object_ids_write_permission.includes(id));
    }

    function checkSubmittable() {
        resp = $('.selectpicker#object-responsible-user').val();
        locat = $('.selectpicker#object-location').val();
        let submit_tooltip = $("#location-form-submit-tooltip");
        let submit_button = $('#location-form-submit').prop('disabled', true);
        let invalid_ids = selected_object_ids.some(id => !object_ids_write_permission.includes(id));
        if(selected_object_ids.length === 0) {
            submit_tooltip.attr("data-original-title", "{{ _('You have to select at least one object.') }}").tooltip("setContent").tooltip('enable');
            submit_button.prop('disabled', true);
            return false;
        } else if (resp === '-1' && locat === '-1') {
            submit_tooltip.attr("data-original-title", "{{ _('You have to select a location or a responsible user.') }}").tooltip("setContent").tooltip('enable');
            submit_button.prop('disabled', true);
            return false;
        } else if(invalid_ids) {
            submit_tooltip.attr("data-original-title", "{{ _('You do not have write permissions for at least one object.') }}").tooltip("setContent").tooltip('enable');
            submit_button.prop('disabled', true);
            return false;
        }
        submit_tooltip.tooltip('disable');
        submit_button.prop('disabled', false);
        return true;
    }

    function handleObjectSelection(cb) {
      let handled_object_id = Number(cb.value);
      const object_index = selected_object_ids.indexOf(handled_object_id);
      if(!cb.checked && object_index >= 0) {
        selected_object_ids.splice(object_index, 1);
      } else if(cb.checked && object_index < 0) {
        selected_object_ids.push(handled_object_id);
      }

      if(checkSomeAvailableSelected() && !checkAllAvailableSelected()) {
        $("#checkbox-select-overall").prop('indeterminate', true);
        $("#checkbox-select-overall").prop('checked', false);
      } else {
        if(checkAllAvailableSelected()) $("#checkbox-select-overall").prop('checked', true);
        else $("#checkbox-select-overall").prop('checked', false);
        $("#checkbox-select-overall").prop('indeterminate', false);
      }
      checkSubmittable();
    }

    $(function() {
      let checkboxSelectOverall = $('#checkbox-select-overall');
      let checkboxSelectChilds = $('.checkbox-select-child');
      checkboxSelectOverall.on('change', function(e) {
        let checked = $(this).prop('checked');
        checkboxSelectChilds.each(function(i, element) {
          if(object_ids_write_permission.includes(Number($(element).prop('value')))) {
            $(element).prop('checked', checked);
            handleObjectSelection(element);
          }
        });
        checkboxSelectOverall.prop('indeterminate', false);
      });

      function updateObjectLocationTranslationJSON() {
        var translation_json = JSON.stringify(window.object_location_translations);
        $('#input-object_location-translations').val(translation_json);
      }

      $('form#assign-location-form').on('submit', function() {
        $('#selected_objects-input').val(selected_object_ids.join(','));
      });

      $("#object-location").on("change", () => checkSubmittable());
      $("#object-responsible-user").on("change", () => checkSubmittable());

      $("#select-language-object_location").on('change', function() {
        var existing_languages = [];
        $.each(window.object_location_translations, function(key, value) {
          existing_languages.push(key);
        });
        let selected = ["{{ ENGLISH.lang_code }}", ];
        let input_descriptions = $('[data-name="input-descriptions"]');
        selected = selected.concat($(this).val());
        let remove_languages = existing_languages.filter(n => !selected.includes(n));
        let add_languages = selected.filter(n => !existing_languages.includes(n));
        for (const del_language of remove_languages) {
          let temp = $("#input-group-object_location-"+del_language);
          $.each(window.object_location_translations, function (key, value) {
            if (key === del_language)
              delete window.object_location_translations[key];
          });
          $(temp).remove();
          updateObjectLocationTranslationJSON();
        }

        for (const new_language of selected) {
          if (!$('#input-group-object_location-' + new_language).length) {
            $($('#object_location-template').html()).insertAfter(input_descriptions.children().last());
            let temp = input_descriptions.children().last();
            let lang_name = window.languages.find(lang => lang.lang_code === new_language).name;
            $(temp).children().first().attr('id', 'textarea-object_location' + new_language.toString());

            $(temp).attr('id', 'input-group-object_location-' + new_language);
            $(temp).attr('data-name', 'input-group-object_location');
            $(temp).children('.input-group-addon[data-name="language"]').text(lang_name);
            $(temp).attr('data-language', new_language);

            $(temp).change(function() {
              var language = $(this).attr('data-language');
              var translation_text = $(this).find('textarea').val();
              window.object_location_translations[language] = translation_text;
              updateObjectLocationTranslationJSON();
            });
            $(temp).find('textarea').change();
          }
          if(add_languages.includes(new_language)) {
            window.object_location_translations[new_language] = '';
          }
          updateObjectLocationTranslationJSON();
        }
      });

      $('#input-group-object_location-{{ ENGLISH.lang_code }}').change(function() {
        var language = $(this).attr('data-language');
        var translation_text = $(this).find('textarea').val();
        window.object_location_translations[language] = translation_text;
        updateObjectLocationTranslationJSON();
      });
      $('#input-group-object_location-{{ ENGLISH.lang_code }}').change();
    });

  </script>
{% endblock %}

{% block content %}
  {# counter for plotly_chart_plots #}
  {% set plot_counter = namespace(value=0) %}
  <script type="text/javascript">
  window.plotly_charts = [];
  </script>
  {% if search_notes is defined %}
  {% for category, note, start, end in search_notes %}
    {% if category == "error" %}
      {% set alert_class="alert-danger" %}
    {% elif category == "warning" %}
      {% set alert_class="alert-warning" %}
    {% else %}
      {% set alert_class="alert-info" %}
    {% endif %}
    <div class="alert {{ alert_class }} alert-dismissible" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      {% if category == "error" %}
        <strong>{{ _('Error:') }}</strong>
      {% elif category == "warning" %}
        <strong>{{ _('Warning:') }}</strong>
      {% else %}
        <strong>{{ _('Note:') }}</strong>
      {% endif %}
      {{ note }}
      {% if search_query and end is none %}
        {% set end = search_query | length %}
      {% endif %}
      {% if search_query and start != end %}
        <br />
        <strong>{{ _('Query:') }}</strong>
        <span class="search-error-full">
          {{ search_query[:start] }}<span class="search-error">{{ search_query[start:end] }}</span>{{ search_query[end:] }}
        </span>
      {% endif %}
    </div>
  {% endfor %}
  {% endif %}
  {% if not advanced_search_had_error %}
  {% if search_tree %}
    {% macro render_search_tree(search_tree, depth=0) -%}
      {% if depth > 100 %}
        ...
      {% else %}
      {% if search_tree.input_text %}
      {{ search_tree.input_text }}
      {% elif search_tree | length  == 2 %}
        <span style="display:flex;flex-direction:row;justify-content: center; align-items:center; background-color: rgba(0, 128, 255, 0.075); border-radius:8px;">
          <span style="margin:5px; font-weight: 800;">{{ search_tree[0].operator }}</span>
          {% if search_tree[1].input_text %}
            <span style="margin:5px; ">{{ search_tree[1].input_text }}</span>
          {% else %}
            <span style="margin:5px; border:1px solid rgba(0, 64, 128, 0.5); border-radius:8px;">{{ render_search_tree(search_tree[1], depth=depth + 1) }}</span>
          {% endif %}
        </span>
      {% elif search_tree | length  == 3 %}
        <span style="display:flex;flex-direction:row;justify-content: center; align-items:center; background-color: rgba(0, 128, 255, 0.075); border-radius:8px;">
          {% if search_tree[0].input_text %}
            <span style="margin:5px; ">{{ search_tree[0].input_text }}</span>
          {% else %}
            <div style="margin:5px; border:1px solid rgba(0, 64, 128, 0.5); border-radius:8px;">{{ render_search_tree(search_tree[0], depth=depth + 1) }}</div>
          {% endif %}
          <span style="margin:5px; font-weight: 800; ">{{ search_tree[1].operator }}</span>
          {% if search_tree[2].input_text %}
            <span style="margin:5px; ">{{ search_tree[2].input_text }}</span>
          {% else %}
            <span style="margin:5px; border:1px solid rgba(0, 64, 128, 0.5); border-radius:8px;">{{ render_search_tree(search_tree[2], depth=depth + 1) }}</span>
          {% endif %}
        </span>
      {% endif %}
      {% endif %}
    {%- endmacro %}
    {% if search_tree.input_text %}
      <span style="display:flex; flex-direction:row;justify-content: center;">
        <span style="padding:5px; border:1px solid rgba(0, 64, 128, 0.5); border-radius:8px; background-color: rgba(0, 128, 255, 0.075)">{{ search_tree.input_text }}</span>
      </span>
    {% else %}
      <span style="display:flex; flex-direction:row;justify-content: center;" id="search-tree">
        <span style="margin:5px; border:1px solid rgba(0, 64, 128, 0.5); border-radius:8px;">{{ render_search_tree(search_tree) }}</span>
      </span>
    {% endif %}
  {% endif %}
  {% endif %}

  {% if objects or not search_notes %}
    <h1>{{ object_name_plural }}</h1>
    {% if filter_action_type_infos or filter_action_infos or filter_instrument_infos or filter_location_infos or filter_related_user_info or filter_user_permissions_info or filter_all_users_permissions or filter_anonymous_permissions or filter_group_permissions_info or filter_project_permissions_info or filter_doi_info or filter_origins_info %}
      <ul>
      {% if filter_action_type_infos %}
        <li>
          {% if filter_action_type_infos | length == 1 %}
            {{ _('for action type:') }}
          {% else %}
            {{ _('for action types:') }}
          {% endif %}
          {% for action_type_info in filter_action_type_infos %}
            <a href="{{ action_type_info.url }}">{{ action_type_info.name }}</a>{% if action_type_info.component_name %}&nbsp;<i class="fa fa-share-alt" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="#{{ action_type_info.fed_id }} @ {{ action_type_info.component_name }}"></i>{% endif %}{% if loop.index + 1 < filter_action_type_infos | length %},{% elif loop.index + 1 == filter_action_type_infos | length %} {{ _('or') }} {% endif %}
          {% endfor %}
        </li>
      {% endif %}
      {% if filter_action_infos %}
        <li>
          {% if filter_action_infos | length == 1 %}
            {{ _('for action:') }}
          {% else %}
            {{ _('for actions:') }}
          {% endif %}
          {% for action_info in filter_action_infos %}
            {% if action_info.instrument %}
              <a href="{{ url_for('.instrument', instrument_id=action_info.instrument.id) }}">{{ action_info.instrument.name | get_translated_text(default=_('Unnamed Instrument')) }}</a> —{% endif %}
            {% if action_info.user %}
              {{ user_reference(action_info.user) }} /
            {% endif %}
            <a href="{{ action_info.url }}">{{ action_info.name }}</a>{% if action_info.component_name %}&nbsp;{% if action_info.fed_url %}<a href="{{ action_info.fed_url }}">{% endif %}<i class="fa fa-share-alt" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="#{{ action_info.fed_id }} @ {{ action_info.component_name }}"></i>{% if action_info.fed_url %}</a>{% endif %}{% endif %}{% if loop.index + 1 < filter_action_infos | length %},{% elif loop.index + 1 == filter_action_infos | length %} {{ _('or') }} {% endif %}
          {% endfor %}
        </li>
      {% endif %}
      {% if filter_instrument_infos %}
        <li>
          {% if filter_instrument_infos | length == 1 %}
            {{ _('for instrument:') }}
          {% else %}
            {{ _('for instruments:') }}
          {% endif %}
          {% for instrument_info in filter_instrument_infos %}
            <a href="{{ instrument_info.url }}">{{ instrument_info.name }}</a>{% if instrument_info.component_name %}&nbsp;{% if instrument_info.fed_url %}<a href="{{ instrument_info.fed_url }}">{% endif %}<i class="fa fa-share-alt" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="#{{ instrument_info.fed_id }} @ {{ instrument_info.component_name }}"></i>{% if instrument_info.fed_url %}</a>{% endif %}{% endif %}{% if loop.index + 1 < filter_instrument_infos | length %},{% elif loop.index + 1 == filter_instrument_infos | length %} {{ _('or') }} {% endif %}
          {% endfor %}
        </li>
      {% endif %}
      {% if filter_location_infos %}
        <li>
          {% if filter_location_infos | length == 1 %}
            {{ _('for location:') }}
          {% else %}
            {{ _('for locations:') }}
          {% endif %}
          {% for location_info in filter_location_infos %}
            <a href="{{ location_info.url }}">{{ location_info.name }}</a>{% if location_info.component_name %}&nbsp;<i class="fa fa-share-alt" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="#{{ location_info.fed_id }} @ {{ location_info.component_name }}"></i>{% endif %}{% if loop.index + 1 < filter_location_infos | length %},{% elif loop.index + 1 == filter_location_infos | length %} {{ _('or') }} {% endif %}
          {% endfor %}
        </li>
      {% endif %}
      {% if filter_doi_info %}
        <li>{{ _('for publication:') }} <a href="http://doi.org/{{ filter_doi_info.doi | urlencode }}">{% if filter_doi_info.title %}{{ filter_doi_info.title }}{% else %}{{ _('Untitled publication') }}{% endif %} (DOI: {{ filter_doi_info.doi }})</a></li>
      {% endif %}
      {% if filter_related_user_info %}
        <li>
        {{ _('with activity by user:') }}
        <a href="{{ filter_related_user_info.url }}">{{ filter_related_user_info.name }}</a>{% if filter_related_user_info.component_name %}&nbsp;<i class="fa fa-share-alt" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="#{{ filter_related_user_info.fed_id }} @ {{ filter_related_user_info.component_name }}"></i>{% endif %}
        </li>
      {% endif %}
      {% if filter_anonymous_permissions %}
        <li>
          {{ _('with %(permissions)s permissions for anonymous users', permissions=_(filter_anonymous_permissions.name.title())) }}
        </li>
      {% endif %}
      {% if filter_all_users_permissions %}
        <li>
          {{ _('with %(permissions)s permissions for all signed-in users', permissions=_(filter_all_users_permissions.name.title())) }}
        </li>
      {% endif %}
      {% if filter_user_permissions_info %}
        <li>
        {% if filter_user_permissions_info.url %}
          {{ _('with %(permissions)s permissions for user:', permissions=filter_user_permissions_info.permissions) }}
          <a href="{{ filter_user_permissions_info.url }}">{{ filter_user_permissions_info.name }}</a>{% if filter_user_permissions_info.component_name %}&nbsp;<i class="fa fa-share-alt" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="#{{ filter_user_permissions_info.fed_id }} @ {{ filter_user_permissions_info.component_name }}"></i>{% endif %}
        {% else %}
          {{ _('with %(permissions)s permissions', permissions=filter_user_permissions_info.permissions) }}
        {% endif %}
        </li>
      {% endif %}
      {% if filter_group_permissions_info %}
        <li>
          {{ _('with %(permissions)s permissions for basic group:', permissions=filter_group_permissions_info.permissions) }}
          <a href="{{ filter_group_permissions_info.url }}">{{ filter_group_permissions_info.name }}</a>
        </li>
      {% endif %}
      {% if filter_project_permissions_info %}
        <li>
          {{ _('with %(permissions)s permissions for project group:', permissions=filter_project_permissions_info.permissions) }}
          <a href="{{ filter_project_permissions_info.url }}">{{ filter_project_permissions_info.name }}</a>
        </li>
      {% endif %}
      {% if filter_origins_info %}
        <li>
        {% if filter_origins_info.local and not filter_origins_info.components %}
          {{ _('from this database') }}
        {% else %}
          {% if filter_origins_info.local %}
            {{ _('from this database and from') }}
          {% else %}
            {{ _('from') }}
          {% endif %}
          {% for component in filter_origins_info.components -%}
            {% if loop.last and not loop.first %}
              {{ _('and') }}
            {%- elif not loop.first -%}
              ,
            {% endif %}
            <a href="{{ url_for('.component', component_id=component.id) }}">{{ component.get_name() }}</a>
          {%- endfor %}
        {% endif %}
        </li>
      {% endif %}
      </ul>
    {% endif %}
  {% endif %}

  <button type="button" class="btn btn-default" data-toggle="modal" data-target="#optionsModal" style="margin-bottom: 10px">
    {{ _('Options') }}
  </button>

  <div class="modal fade" id="optionsModal" tabindex="-1" role="dialog" aria-labelledby="optionsModalLabel">
    <div class="modal-dialog" role="document">
      <form method="get" class="form">
        {% for key in request.args %}
          {% if key not in ['object_list_options', 'display_properties', 'creation_info', 'last_edit_info', 'action_info', 'other_databases_info', 'location_info'] %}
            {% for value in request.args.getlist(key) %}
              <input type="hidden" name="{{ key }}" value="{{ value }}" />
            {% endfor %}
          {% endif %}
        {% endfor %}
        <input type="hidden" name="object_list_options" value="" />
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="optionsModalLabel">{{ _('Options') }}</h4>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label class="control-label" for="select_display_properties">
                {{ _('Show additional properties') }}
              </label>
              <select class="selectpicker form-control" multiple="multiple" name="display_properties" data-width="100%" id="select_display_properties" data-live-search="true" data-none-selected-text="{{ _('No additional properties') }}">
                {% for property_name in search_paths | sort %}
                  <option value="{{ property_name }}" {% if display_properties and property_name in display_properties %}selected="selected"{% endif %}>{{ property_name }} – {{ search_paths[property_name]['titles'] | join(', ') }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="form-group">
              <label class="control-label">
                {{ _('Show creation information') }}
              </label>
              <div>
                <label style="font-weight: normal">
                  <input type="checkbox" {% if 'date' in creation_info %}checked="checked"{% endif %} name="creation_info" value="date" /> {{ _('Show Date') }}
                </label>
              </div>
              <div>
                <label style="font-weight: normal">
                  <input type="checkbox" {% if 'user' in creation_info %}checked="checked"{% endif %} name="creation_info" value="user" /> {{ _('Show User') }}
                </label>
              </div>
            </div>
            <div class="form-group">
              <label class="control-label">
                {{ _('Show last edit information') }}
              </label>
              <div>
                <label style="font-weight: normal">
                  <input type="checkbox" {% if 'date' in last_edit_info %}checked="checked"{% endif %} name="last_edit_info" value="date" /> {{ _('Show Date') }}
                </label>
              </div>
              <div>
                <label style="font-weight: normal">
                  <input type="checkbox" {% if 'user' in last_edit_info %}checked="checked"{% endif %} name="last_edit_info" value="user" /> {{ _('Show User') }}
                </label>
              </div>
            </div>
            {% if config['FEDERATION_UUID'] %}
            <div class="form-group">
              <label class="control-label">
                {{ _('Show Other Database information') }}
              </label>
              <div>
                <label style="font-weight: normal">
                  <input type="checkbox" {% if other_databases_info %}checked="checked"{% endif %} name="other_databases_info" value="other_databases_info" /> {{ _('Show Other Databases') }}
                </label>
              </div>
            </div>
            {% endif %}
            <div class="form-group">
              <label class="control-label">
                {{ _('Show Action information') }}
              </label>
              {% if not config['DISABLE_INSTRUMENTS'] %}
              <div>
                <label style="font-weight: normal">
                  <input type="checkbox" {% if 'instrument' in action_info %}checked="checked"{% endif %} name="action_info" value="instrument" /> {{ _('Show Instrument') }}
                </label>
              </div>
              {% endif %}
              <div>
              <label style="font-weight: normal">
                <input type="checkbox" {% if 'action' in action_info %}checked="checked"{% endif %} name="action_info" value="action" /> {{ _('Show Action') }}
              </label>
              </div>
            </div>
            <div class="form-group">
              <label class="control-label">
                {{ _('Show Location and Responsibility information') }}
              </label>
              <div>
                <label style="font-weight: normal">
                  <input type="checkbox" {% if 'location' in location_info %}checked="checked"{% endif %} name="location_info" value="location" /> {{ _('Show Location') }}
                </label>
              </div>
              <div>
              <label style="font-weight: normal">
                <input type="checkbox" {% if 'responsible_user' in location_info %}checked="checked"{% endif %} name="location_info" value="responsible_user" /> {{ _('Show Responsible User') }}
              </label>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-default" name="save_default_options" formmethod="post">{{ _('Save') }}</button>
            <button type="submit" class="btn btn-default" name="clear_default_options" formmethod="post">{{ _('Clear') }}</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">{{ _('Close') }}</button>
            <button type="submit" class="btn btn-primary">{{ _('Apply') }}</button>
          </div>
        </div>
      </form>
    </div>
  </div>


  {% if show_filters %}
  <button type="button" class="btn btn-default" data-toggle="modal" data-target="#filtersModal" style="margin-bottom: 10px">
    {{ _('Filters') }}
  </button>

  <div class="modal fade" id="filtersModal" tabindex="-1" role="dialog" aria-labelledby="filtersModalLabel">
    <div class="modal-dialog" role="document">
      <form method="get" class="form">
        {% for key in request.args %}
          {% if key not in ['object_list_filters', 'action_type_ids', 'action_ids', 'instrument_ids', 'user', 'user_permissions', 'all_users_permissions', 'anonymous_permissions', 'location_ids', 't', 'action', 'location', 'offset', 'doi', 'origins'] %}
            {% for value in request.args.getlist(key) %}
              <input type="hidden" name="{{ key }}" value="{{ value }}" />
            {% endfor %}
          {% endif %}
        {% endfor %}
        <input type="hidden" name="object_list_filters" value="" />
        <input type="hidden" name="user" value="{{ current_user.id }}" />
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="filtersModalLabel">{{ _('Filters') }}</h4>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label class="control-label" for="filter_permissions">
                {{ _('Filter by Permissions') }}
              </label>
              <select class="selectpicker form-control" name="user_permissions" id="filter_permissions" data-width="100%">
                {% for permissions in [Permissions.READ, Permissions.WRITE, Permissions.GRANT] %}
                  <option value="{{ permissions.name.lower() }}" {% if permissions == filter_user_permissions or (permissions == Permissions.READ and filter_user_permissions is none) %}selected="selected"{% endif %}>{{ _(permissions.name.title()) }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="form-group">
              <label class="control-label" for="filter_all_users_permissions">
                {{ _('Filter by Permissions for All Signed-In Users') }}
              </label>
              <select class="selectpicker form-control" name="all_users_permissions" id="filter_all_users_permissions" data-width="100%">
                <option value="" {% if filter_all_users_permissions is none %}selected="selected"{% endif %}>&mdash;</option>
                {% for permissions in [Permissions.READ] %}
                  <option value="{{ permissions.name.lower() }}" {% if permissions == filter_all_users_permissions %}selected="selected"{% endif %}>{{ _(permissions.name.title()) }}</option>
                {% endfor %}
              </select>
            </div>
            {% if config['ENABLE_ANONYMOUS_USERS'] %}
            <div class="form-group">
              <label class="control-label" for="filter_anonymous_permissions">
                {{ _('Filter by Permissions for Anonymous Users') }}
              </label>
              <select class="selectpicker form-control" name="anonymous_permissions" id="filter_anonymous_permissions" data-width="100%">
                <option value="" {% if filter_anonymous_permissions is none %}selected="selected"{% endif %}>&mdash;</option>
                {% for permissions in [Permissions.READ] %}
                  <option value="{{ permissions.name.lower() }}" {% if permissions == filter_anonymous_permissions %}selected="selected"{% endif %}>{{ _(permissions.name.title()) }}</option>
                {% endfor %}
              </select>
            </div>
            {% endif %}
            <div class="form-group">
              <label class="control-label" for="filter_action_type_ids">
                {{ _('Filter by Action Type') }}
              </label>
              <select class="selectpicker form-control" multiple="multiple" name="action_type_ids" id="filter_action_type_ids" data-width="100%" data-none-selected-text="{{ _('All action types') }}" data-hide-disabled="true">
                {% for action_type in all_action_types %}
                  <option {% if action_type.component_id is not none %}data-icon="fa fa-share-alt"{% endif %} value="{{ action_type.id }}" {% if filter_action_type_ids and action_type.id in filter_action_type_ids %}selected="selected"{% endif %} data-source="{% if action_type.component_id is none %}local{% else %}component_{{ action_type.component_id }}{% endif %}">{{ action_type.name | get_translated_text(default=_('Unnamed Action Type')) }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="form-group">
              <label class="control-label" for="filter_action_ids">
                {{ _('Filter by Action') }}
              </label>
              <select class="selectpicker form-control" multiple="multiple" name="action_ids" id="filter_action_ids" data-width="100%" data-none-selected-text="{{ _('All actions') }}" data-live-search="on" data-hide-disabled="true">>
                {% for action in all_actions %}
                  <option {% if action.component_id is not none %}data-icon="fa fa-share-alt"{% endif %} value="{{ action.id }}" {% if filter_action_ids and action.id in filter_action_ids %}selected="selected"{% endif %} data-source="{% if action.component_id is none %}local{% else %}component_{{ action.component_id }}{% endif %}">
                    {% if action.instrument %}{{ action.instrument.name | get_translated_text(default=_('Unnamed Instrument')) }} — {% endif %}
                    {% if action.user %}{{ action.user.get_name() }} / {% endif %}
                    {{ action.name | get_translated_text(default=_('Unnamed Action')) }} (#{{ action.id }})
                  </option>
                {% endfor %}
              </select>
            </div>
            <div class="form-group">
              <label class="control-label" for="filter_instrument_ids">
                {{ _('Filter by Instrument') }}
              </label>
              <select class="selectpicker form-control" multiple="multiple" name="instrument_ids" id="filter_instrument_ids" data-width="100%" data-none-selected-text="{{ _('All instruments') }}" data-live-search="on" data-hide-disabled="true">>
                {% for instrument in all_instruments %}
                  <option {% if instrument.component_id is not none %}data-icon="fa fa-share-alt"{% endif %} value="{{ instrument.id }}" {% if filter_instrument_ids and instrument.id in filter_instrument_ids %}selected="selected"{% endif %} data-source="{% if instrument.component_id is none %}local{% else %}component_{{ instrument.component_id }}{% endif %}">
                    {{ instrument.name | get_translated_text(default=_('Unnamed Instrument')) }}  (#{{ instrument.id }})
                  </option>
                {% endfor %}
              </select>
            </div>
            <div class="form-group">
              <label class="control-label" for="filter_location_ids">
                {{ _('Filter by Location') }}
              </label>
              <select class="selectpicker form-control" multiple="multiple" name="location_ids" id="filter_location_ids" data-width="100%" data-none-selected-text="{{ _('All locations') }}" data-live-search="on">
                {% for location in all_locations %}
                  <option {% if location.component is not none %}data-icon="fa fa-share-alt"{% endif %} value="{{ location.id }}" {% if filter_location_ids and location.id in filter_location_ids %}selected="selected"{% endif %}>{{ location.name | get_translated_text }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="form-group">
              <label class="control-label" for="filter_doi">
                {{ _('Filter by Publication') }}
              </label>
              <select class="selectpicker form-control" name="doi" id="filter_doi" data-width="100%" data-none-selected-text="{{ _('All publications') }}" data-live-search="on">
                <option value="">{{ _('All publications') }}</option>
                {% for doi, title in all_publications %}
                  <option value="{{ doi }}" {% if filter_doi and doi == filter_doi %}selected="selected"{% endif %}>{% if title %}{{ title }}{% else %}{{ _('Untitled publication') }}{% endif %} (DOI: {{ doi }})</option>
                {% endfor %}
              </select>
            </div>
            {% if all_components %}
            <div class="form-group">
              <label class="control-label" for="filter_origin_ids">
                {{ _('Filter by Origin') }}
              </label>
              <select class="selectpicker form-control" name="origins" id="filter_origin_ids" multiple="multiple" data-width="100%" data-none-selected-text="{{ _('All origins') }}" data-live-search="on">
                <option value="local" {% if filter_origin_ids and ('local', none) in filter_origin_ids %}selected="selected"{% endif %}>{{ config["SERVICE_NAME"] }}</option>
                <optgroup label="{{ _('Other Databases') }}">
                {% for component in all_components %}
                  <option value="component_{{ component.id }}" {% if filter_origin_ids and ('component', component.id) in filter_origin_ids %}selected="selected"{% endif %}>{{ component.get_name() }}</option>
                {% endfor %}
                </optgroup>
              </select>
            </div>
            {% endif %}
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-default" name="save_default_filters" formmethod="post">{{ _('Save') }}</button>
            <button type="submit" class="btn btn-default" name="clear_default_filters" formmethod="post">{{ _('Clear') }}</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">{{ _('Close') }}</button>
            <button type="submit" class="btn btn-primary">{{ _('Apply') }}</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  {% endif %}

  <a href="{{ url_for('.search') }}" class="btn btn-default" style="margin-bottom: 10px">
    {{ _('Search') }}
  </a>

  {% if not edit_location %}
    <a href="{{ build_modified_url(edit_location=True) }}" class="btn btn-primary" style="margin-bottom: 10px">
      <i class="fa fa-map-marker" aria-hidden="true"></i> {{ _('Assign Location') }}
    </a>
  {% else %}

  {% set allowed_language_ids = [] %}
  {% for language in all_languages %}
    {% if language.enabled_for_input %}
      {{ allowed_language_ids.append(language.id) or '' }}
    {% endif %}
  {% endfor %}

  <form id="assign-location-form" method="post" action="{{ url_for('.edit_multiple_locations') }}">
    {{ location_form.csrf_token }}
    <div class="modal-body">
        <div class="form-group">
            <label for="object-location" class="control-label">{{ _('Location') }}</label>
            <select class="treepicker selectpicker form-control" id="object-location" name="{{ location_form.location.name }}" data-live-search="true" >
              {% for location_info in location_form.location.all_choices %}
                  <option {% if location_info.is_fed %}data-icon="fa fa-share-alt"{% endif %} value="{{ location_info.id }}" {% if location_form.location.data == (location_info.id_string) %}selected="selected"{% endif %} {% if location_info.is_disabled %}disabled="disabled"{% endif %} data-content="<span class='{% if location_info.has_subtree %}option-group-{{ location_info.id }}-header{% endif %} closed {% for id in location_info.id_path[:-1] %}option-group-{{ id }}-member option-group-{{ id }}-closed {% endfor %}' style='padding-left:{{ 1.5 * (location_info.id_path | length - 1) }}em'>{% if location_info.has_subtree %}<span class='selectpicker-collapsible-menu'><i class='fa'></i></span> {% endif %}<span class='location_path'>{{ location_info.name_prefix }}</span>{{ location_info.name }}</span>">
                      {{ location_info.full_name }}
                  </option>
              {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="object-responsible-user" class="control-label">{{ _('Responsible User') }}</label>
            <select class="selectpicker form-control" id="object-responsible-user" name="{{ location_form.responsible_user.name }}" data-live-search="true">
                {% for user_id, username in location_form.responsible_user.choices %}
                <option {% if user_is_fed[user_id] %} data-icon="fa fa-share-alt"{% endif %} value="{{ user_id }}" {% if location_form.responsible_user.data == user_id %} selected="selected" {% endif %}>{% if user_id == '-1' %}&mdash;{% else %} {{ username }} {% endif %}</option>
                {% endfor %}
            </select>
        </div>

        <div class="hidden" id="object_location-template">
            <div class="input-group" data-name="input-group-object_location" style="margin-top: 5px" id="">
                <textarea class="form-control" rows="3" placeholder="{{ _('Description') }}" style="resize: vertical; min-height: 2.5em"></textarea>
                <span class="input-group-addon language-addon" data-name="language"></span>
            </div>
        </div>
        <div class="form-group" {% if location_form.description.name in location_form.errors %} has-error {% endif %} data-name="input-descriptions">
            <label for="object-location" class="control-label" style="padding-right: 5px">{{ _('Description') }}</label>
            <select class="selectpicker pull-right select-language {% if allowed_language_ids | length <= 1 %} hidden {% endif %}" multiple="multiple" data-style="btn-default btn-xs" id="select-language-object_location">
                {% for language in all_languages %}
                <option value="{{ language.lang_code }}" {% if language.id == ENGLISH.id %} disabled="disabled" selected="selected" {% endif %}>{{ language.names | get_translated_text }}</option>
                {% endfor %}
            </select>

            <div {% if allowed_language_ids | length > 1 %} class="input-group" {% endif %} id="input-group-object_location-{{ ENGLISH.lang_code }}" data-name="input-group-object_location" data-language="{{ ENGLISH.lang_code}}">
                <textarea class="form-control" rows="3" placeholder="{{ _('Description') }}" style="resize:vertical; min-height:2.5em;" id="textarea-object_location-{{ ENGLISH.lang_code }}"></textarea>
                {% if allowed_language_ids | length > 1 %}
                    <span class="input-group-addon language-addon" data-name="language"> {{ ENGLISH.names | get_translated_text }} </span>
                {% endif %}
            </div>
        </div>
        <input hidden="hidden" type="text" value="" id="input-object_location-translations" name="{{ location_form.description.name }}" />
        <input hidden="hidden" type="text" value="" id="selected_objects-input" name="selected_objects" />
        <div class="text-right">
          <a type="button" class="btn btn-default" data-dismiss="modal" href="{{ build_modified_url(blocked_parameters=['edit_location']) }}">{{ _('Cancel') }} </a>
          <span class="d-inline-block" id="location-form-submit-tooltip" tabindex="0" data-toggle="tooltip" title="{{ _("You have to select at least one object.") }}">
            <button type="submit" id="location-form-submit" class="btn btn-primary" disabled><i class="fa fa-map-marker fa-fw"></i> {{ _('Assign Location') }} </button>
          </span>
        </div>
    </div>
  </form>
  {% endif %}

  {% if objects %}
  </div>

  <div class="container" {% with user_settings = get_user_settings() %}{% if user_settings['FULL_WIDTH_OBJECTS_TABLE'] or (user_settings['FULL_WIDTH_OBJECTS_TABLE'] is none and config['FULL_WIDTH_OBJECTS_TABLE']) %}id="table-objects-container"{% endif %}{% endwith %}>
  <table class="table" id="table-objects">
  <thead>
    <tr>
      {% if edit_location %}
        <th scope="col" rowspan="2">
          <input id="checkbox-select-overall" type="checkbox" value="state" />
        </th>
      {% endif %}
      <th scope="col" {% if creation_info or last_edit_info %}rowspan="2"{% endif %}>{{ _('ID') }} <span class="icons-sorting"><a href="{{ build_modified_url(sortby='_object_id', order='asc') }}"><i class="glyphicon glyphicon glyphicon-triangle-top {% if sorting_property == '_object_id' and sorting_order == 'asc' %}current_sorting_property{% endif %}" aria-hidden="true"></i></a><a href="{{ build_modified_url(sortby='_object_id', order='desc') }}"><i class="glyphicon glyphicon glyphicon-triangle-bottom {% if sorting_property == '_object_id' and sorting_order == 'desc' %}current_sorting_property{% endif %}" aria-hidden="true"></i></a></span></th>
      <th scope="col" {% if creation_info or last_edit_info %}rowspan="2"{% endif %}>{{ _('Name') }} <span class="icons-sorting"><a href="{{ build_modified_url(sortby='name', order='asc') }}"><i class="glyphicon glyphicon glyphicon-triangle-top {% if sorting_property == 'name' and sorting_order == 'asc' %}current_sorting_property{% endif %}" aria-hidden="true"></i></a><a href="{{ build_modified_url(sortby='name', order='desc') }}"><i class="glyphicon glyphicon glyphicon-triangle-bottom {% if sorting_property == 'name' and sorting_order == 'desc' %}current_sorting_property{% endif %}" aria-hidden="true"></i></a></span></th>
      {% if creation_info %}
        <th scope="col" {% if 'user' in creation_info and 'date' in creation_info %}colspan="2"{% endif %}>{{ _('Created') }}</th>
      {% endif %}
      {% if last_edit_info %}
        <th scope="col"  {% if 'user' in last_edit_info and 'date' in last_edit_info %}colspan="2"{% endif %}>{{ _('Last modified') }}</th>
      {% endif %}
      {% if other_databases_info %}
        <th scope="col" {% if creation_info or last_edit_info %}rowspan="2"{% endif %}>{{ _('Other Databases') }}</th>
      {% endif %}
      {% if 'instrument' in action_info and not config['DISABLE_INSTRUMENTS'] %}
        <th scope="col" {% if creation_info or last_edit_info %}rowspan="2"{% endif %}>{{ _('Instrument') }}</th>
      {% endif %}
      {% if 'action' in action_info %}
        <th scope="col" {% if creation_info or last_edit_info %}rowspan="2"{% endif %}>{{ _('Action') }}</th>
      {% endif %}
      {% if 'location' in location_info %}
        <th scope="col" {% if creation_info or last_edit_info %}rowspan="2"{% endif %}>{{ _('Location') }}</th>
      {% endif %}
      {% if 'responsible_user' in location_info %}
        <th scope="col" {% if creation_info or last_edit_info %}rowspan="2"{% endif %}>{{ _('Responsible User') }}</th>
      {% endif %}
      {% for property_name in display_properties %}
        <th scope="col" {% if creation_info or last_edit_info %}rowspan="2"{% endif %}>{{ display_property_titles.get(property_name, property_name | e) | get_translated_text | safe }}{% if property_name not in ('hazards', 'tags') %} <span class="icons-sorting"><a href="{{ build_modified_url(sortby=property_name, order='asc') }}"><i class="glyphicon glyphicon glyphicon-triangle-top {% if sorting_property == property_name and sorting_order == 'asc' %}current_sorting_property{% endif %}" aria-hidden="true"></i></a><a href="{{ build_modified_url(sortby=property_name, order='desc') }}"><i class="glyphicon glyphicon glyphicon-triangle-bottom {% if sorting_property == property_name and sorting_order == 'desc' %}current_sorting_property{% endif %}" aria-hidden="true"></i></a></span>{% endif %}</th>
      {% endfor %}
    </tr>
    {% if creation_info or last_edit_info %}
    <tr>
      {% if 'date' in creation_info %}
        <th scope="col">{{ _('Date') }} <span class="icons-sorting"><a href="{{ build_modified_url(sortby='_creation_date', order='asc') }}"><i class="glyphicon glyphicon glyphicon-triangle-top {% if sorting_property == '_creation_date' and sorting_order == 'asc' %}current_sorting_property{% endif %}" aria-hidden="true"></i></a><a href="{{ build_modified_url(sortby='_creation_date', order='desc') }}"><i class="glyphicon glyphicon glyphicon-triangle-bottom {% if sorting_property == '_creation_date' and sorting_order == 'desc' %}current_sorting_property{% endif %}" aria-hidden="true"></i></a></span></th>
      {% endif %}
      {% if 'user' in creation_info %}
        <th scope="col">{{ _('User') }}</th>
      {% endif %}
      {% if 'date' in last_edit_info %}
        <th scope="col">{{ _('Date') }} <span class="icons-sorting"><a href="{{ build_modified_url(sortby='_last_modification_date', order='asc') }}"><i class="glyphicon glyphicon glyphicon-triangle-top {% if sorting_property == '_last_modification_date' and sorting_order == 'asc' %}current_sorting_property{% endif %}" aria-hidden="true"></i></a><a href="{{ build_modified_url(sortby='_last_modification_date', order='desc') }}"><i class="glyphicon glyphicon glyphicon-triangle-bottom {% if sorting_property == '_last_modification_date' and sorting_order == 'desc' %}current_sorting_property{% endif %}" aria-hidden="true"></i></a></span></th>
      {% endif %}
      {% if 'user' in last_edit_info %}
        <th scope="col">{{ _('User') }}</th>
      {% endif %}
    </tr>
    {% endif %}
  </thead>
  <tbody>
  {% for object in objects %}
    <tr>
      {% if edit_location %}
      <td><input type="checkbox" name="cb-{{object.object_id}}" class="checkbox-select-child" value="{{object.object_id}}" onclick="handleObjectSelection(this)" {% if object.object_id not in objects_with_write_permission %} disabled="disabled" data-toggle="tooltip" data-placement="right" title="{{ _('You need at least write permission to change the location of an object.') }}" {% endif %}/> </td>
      {% endif %}
      <th scope="row"><a href="{{ url_for('.object', object_id=object.object_id) }}">{{ object.object_id }}</a></th>
      <td>
        <a href="{{ url_for('.object', object_id=object.object_id) }}">{% if object.name | get_translated_text == '' %}&mdash;{% else %}{{ object.name | get_translated_text }}{% endif %}</a>
        {{ import_information_symbol(FederationObjectRef(fed_id=object.fed_id, component_uuid=object.component.uuid)) }}
      </td>
      {% if 'date' in creation_info %}
      <td class="nowrap">{{ object.created_at | babel_format_date }}</td>
      {% endif %}
      {% if 'user' in creation_info %}
      <td>
        {{ user_reference(object.created_by) }}
      </td>
      {% endif %}
      {% if 'date' in last_edit_info %}
      <td class="nowrap">{% if object.last_modified_at is not none %}{{ object.last_modified_at | babel_format_date }}{% else %}&mdash;{% endif %}</td>
      {% endif %}
      {% if 'user' in last_edit_info %}
      <td>
        {{ user_reference(object.modified_by) }}
      </td>
      {% endif %}
      {% if other_databases_info %}
        <td>
        {% set shares = get_shares_for_object(object.object_id) %}
        {% set components = [] %}
        {% if object.component is not none %}
          {{ components.append(object.component) or '' }}
          <span data-toggle="tooltip" data-placement="top" title="{{ _('Shared by %(component_name)s', component_name=object.component.get_name()) }}">
            <i class="fa fa-arrow-left"></i>&nbsp;<a href="{{ url_for('.component', component_id=object.component_id) }}">{{ object.component.get_name() }}</a>
          </span>
        {% endif %}
        {% for share in shares %}
          {% if share.component is not none %}
            {{ components.append(share.component) or '' }}
            <span data-toggle="tooltip" data-placement="top" title="{{ _('Shared with %(component_name)s', component_name=share.component.get_name()) }}">
              <i class="fa fa-arrow-right"></i>&nbsp;<a href="{{ url_for('.component', component_id=share.component_id) }}">{{ share.component.get_name() }}</a>
            </span>
          {% endif %}
        {% endfor %}
        {% if not components %}
          &mdash;
        {% endif %}
        </td>
      {% endif %}
      {% if object.action is not none %}
        {% if 'instrument' in action_info and not config['DISABLE_INSTRUMENTS'] %}
        {% if object.action.instrument is not none %}
          <td><a href="{{ url_for('.instrument', instrument_id=object.action.instrument_id) }}">{{ object.action.instrument.name | get_translated_text(default=_('Unnamed Instrument')) }}</a>
            {{ import_information_symbol(object.action.instrument) }}
          </td>
        {% else %}
          <td>&mdash;</td>
        {% endif %}
        {% endif %}
        {% if 'action' in action_info %}
        <td>
          <a href="{{ url_for('.action', action_id=object.action.id) }}">
            {{ object.action.name | get_translated_text(default=_('Unnamed Action')) }}
          </a>
          {{ import_information_symbol(object.action) }}
        </td>
        {% endif %}
      {% endif %}
      {% if 'location' in location_info %}
        <td>
          {% if object.location_id is none %}
            &mdash;
          {% else %}
            {% with location = get_location(object.location_id) %}
              <a href="{{ url_for('frontend.location', location_id=location.id) }}">
                {{ location | get_location_name(True) }}
              </a>
              {{ import_information_symbol(location) }}
            {% endwith %}
          {% endif %}
        </td>
      {% endif %}
      {% if 'responsible_user' in location_info %}
        <td>
          {% if object.responsible_user_id is none %}
            &mdash;
          {% else %}
            {{ user_reference(object.responsible_user_id) }}
          {% endif %}
        </td>
      {% endif %}
      {% for property_name in display_properties %}
        {% if object.display_properties[property_name] is not none %}
          {% set metadata_language = none %}
          {% set data = object.display_properties[property_name][0] %}
          {% set schema = object.display_properties[property_name][1] %}
          {% set z = schema.update({'parent_style': 'table'}) %}
          <td>
          {% include "objects/view/any.html" %}
          </td>
        {% else %}
          <td> &mdash; </td>
        {% endif %}
      {% endfor %}
    </tr>
  {% endfor %}
  </tbody>
  </table>
  </div>

  <div class="container">
  {% if pagination_enabled %}
    <div>
    {{ _('Pages') }}:
    <ol class="object-pagination">
    {% if limit and num_objects_found %}
      {% for i in range((num_objects_found+limit-1)//limit) %}
        {% if i * limit == offset %}
          <li>{{ i + 1 }}</li>
        {% else %}
          <li><a href="{{ build_modified_url(limit=limit, offset=i*limit) }}">{{ i + 1 }}</a></li>
        {% endif %}
      {% endfor %}
    {% else %}
      <li>1</li>
    {% endif %}
    </ol>
    </div>
    <div>
    {{ _('Objects per page') }}:
    <ol class="object-pagination">
    {% for i in (10, 25, 50, 100, 'all') %}
      {% if i == limit or (limit is none and i == 'all') %}
        <li>{% if i == 'all' %}{{ _('all') }}{% else %}{{ i }}{% endif %}</li>
      {% else %}
        <li><a href="{{ build_modified_url(limit=i, offset=0) }}">{% if i == 'all' %}{{ _('all') }}{% else %}{{ i }}{% endif %}</a></li>
      {% endif %}
    {% endfor %}
    </ol>
    </div>
  {% endif %}
  {% elif not search_notes and use_advanced_search and advanced_search_had_error %}
    <div class="alert alert-danger" role="alert">
      {{ _('Failed to interpret advanced search query. Please check your query or try the regular search instead.') }}
    </div>
  {% elif not advanced_search_had_error %}
    <div class="alert alert-warning" role="alert">
      {{ _('No objects were found.') }}
    </div>
  {% endif %}
{% endblock %}
