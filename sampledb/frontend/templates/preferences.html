<!-- extend from base layout -->
{% extends "base.html" %}

{% block title %}{{ _('Preferences') }} — {{ service_name }}{% endblock %}

{% block sidebar %}
  <nav>
    <ul>
      <li><a href="#account_information">{{ _('Account Information') }}</a></li>
      <li><a href="#authentication_methods">{{ _('Authentication Methods') }}</a>
        <ul>
          <li><a href="#api_tokens">{{ _('API Tokens') }}</a></li>
          <li><a href="#api_access_tokens">{{ _('API Access Tokens') }}</a></li>
          <li><a href="#2fa">{{ _('Two-Factor Authentication') }}</a></li>
        </ul>
      </li>
      {% if may_use_webhooks %}
      <li><a href="#webhooks">{{ _('Webhooks') }}</a></li>
      {% endif %}
      <li><a href="#notification_settings">{{ _('Notification Settings') }}</a></li>
      <li><a href="#default_permissions">{{ _('Default Permissions') }}</a></li>
      <li><a href="#other_settings">{{ _('Other Settings') }}</a></li>
      <li><a href="#administrator_settings">{{ _('Administrator Settings') }}</a></li>
    </ul>
    <a href="#top">{{ _('Back to top') }}</a>
  </nav>
{% endblock %}

{% block content %}
<h1>{{ _('Preferences') }}</h1>
<h2 id="account_information">{{ _('Account Information') }}</h2>
<form class="form-horizontal" method="post" name="form-preference-name-and-email" action="{{ url_for('.user_preferences', user_id=current_user.id) }}">
    {{ change_user_form.csrf_token() }}
    <div class="form-group {% if change_user_form.name.errors %} has-error{% endif %}">
        <label for="input-username" class="col-sm-4 control-label">{{ _('Name') }}</label>
        <div class="col-sm-8">
            <input class="form-control" type="text" id="input-username" name="{{change_user_form.name.name}}" value="{{ change_user_form.name.data }}" placeholder="{{ _('Name') }}">
            {% if change_user_form.name.errors %}
              <span class="help-block">{{ change_user_form.name.errors[0] }}</span>
            {% elif config['ENFORCE_SPLIT_NAMES'] and current_user.type.name.lower() == "person" and (change_user_form.name.data is none or ', ' not in change_user_form.name.data[1:-1]) %}
              <span class="help-block">{{ _("Please enter your name as: surname, given names.") }}</span>
            {% endif %}
        </div>
    </div>
    <div class="form-group{% if change_user_form.email.errors %} has-error{% endif %}">
        <label for="input-email" class="col-sm-4 control-label">{{ _('Email') }}</label>
        <div class="col-sm-8">
             <input class="form-control" type="text" id="input-email" name="{{change_user_form.email.name}}" value="{{ change_user_form.email.data }}" placeholder="{{ _('Email') }}">
            {% if change_user_form.email.errors %}
              <span class="help-block">{{ _('Please enter your email address.') }}</span>
            {% endif %}
        </div>
    </div>
    <div class="form-group {% if change_user_form.orcid.errors %} has-error{% endif %}">
        <label for="input-orcid" class="col-sm-4 control-label">ORCID iD</label>
        <div class="col-sm-8">
        <div class="input-group">
          <span class="input-group-addon">https://orcid.org/</span>
          <input class="form-control" type="text" id="input-orcid" name="{{change_user_form.orcid.name}}" value="{{ change_user_form.orcid.data or '' }}" placeholder="xxxx-xxxx-xxxx-xxxx">
        </div>
        {% if change_user_form.orcid.errors %}
          <span class="help-block">{{ _('Please enter your ORCID iD or leave this field blank.') }}</span>
        {% endif %}
        </div>
    </div>
    <div class="form-group {% if change_user_form.affiliation.errors %} has-error{% endif %}">
        <label for="input-affiliation" class="col-sm-4 control-label">{{ _('Affiliation') }}</label>
        <div class="col-sm-8">
          <input class="form-control" type="text" id="input-affiliation" name="{{change_user_form.affiliation.name}}" value="{{ change_user_form.affiliation.data or ""}}" placeholder="{{ _('Affiliation, e.g. your institute, company or department') }}">
          {% if change_user_form.affiliation.errors %}
            <span class="help-block">{{ _('Please enter your affiliation or leave this field blank.') }}</span>
          {% endif %}
        </div>
    </div>
    <div class="form-group {% if change_user_form.role.errors %} has-error{% endif %}">
        <label for="input-role" class="col-sm-4 control-label">{{ _('Role') }}</label>
        <div class="col-sm-8">
          <input class="form-control" type="text" id="input-role" name="{{change_user_form.role.name}}" value="{{ change_user_form.role.data or ""}}" placeholder="{{ _('Role, e.g. PhD student, principal investigator or technician') }}">
          {% if change_user_form.role.errors %}
            <span class="help-block">{{ _('Please enter your role or leave this field blank.') }}</span>
          {% endif %}
        </div>
    </div>
    {% for extra_field_id, extra_field in EXTRA_USER_FIELDS.items() %}
    <div class="form-group">
        <label for="extra_field_{{ extra_field_id }}" class="col-sm-4 control-label">{{ (extra_field.name | get_translated_text) or extra_field_id }}</label>
        <div class="col-sm-8">
          <input class="form-control" type="text" id="extra_field_{{ extra_field_id }}" name="extra_field_{{ extra_field_id }}" value="{{ (current_user.extra_fields or {}).get(extra_field_id, '') }}" placeholder="{{ (extra_field.placeholder | get_translated_text) or (extra_field.name | get_translated_text) or extra_field_id }}">
        </div>
    </div>
    {% endfor %}
    <div class="form-group">
        <button type="submit" class="btn btn-primary col-md-offset-9 col-md-3" name="change" value="Change">{{ _('Save') }}</button>
    </div>
</form>


<h2 id="authentication_methods">{{ _('Authentication Methods')}}</h2>
    <div>
       <table class="table">
         <thead>
             <tr>
                 <th>{{ _('Username / Email') }}</th>
                 <th>{{ _('Authentication Method')}}</th>
                 <th></th>
             </tr>
         </thead>
         <tbody>
           {% for authentication in authentications %}
           {% if authentication.type.name.lower() != 'federated_login' or (authentication.type.name.lower() == 'federated_login' and config["ENABLE_FEDERATED_LOGIN"]) %}
           <tr>
               <td style="vertical-align: middle;">
                  {% if authentication.type.name.lower() != 'federated_login' %}
                    {{authentication.login.get('login', authentication.login.get('description', ''))}}
                  {% else %}
                    {% set fed_user = get_user(user_id=authentication.login.get('fed_user_id'), component_id=authentication.login.get('component_id')) %}
                    <a href="{{ url_for('.user_profile', user_id=fed_user.id) }}">{{ fed_user.get_name() }}</a> (<a href="{{ url_for('.component', component_id=fed_user.component.id) }}">{{ fed_user.component.get_name() }}</a>)
                    {{ import_information_symbol(fed_user) }}
                  {% endif %}
               </td>
               <td style="vertical-align: middle;">{{
                  {
                    'ldap': 'LDAP',
                    'email': _('Email'),
                    'other': _('Other'),
                    'fido2_passkey': _('FIDO2 Passkey'),
                    'federated_login': _('Federated Login'),
                    'oidc': _('OIDC'),
                  }[authentication.type.name.lower()]
               }}</td>
               <td class="text-right">
                   <form method="post" name="form-remove-authentication-methods" action="{{ url_for('.user_preferences', user_id=current_user.id) }}">
                       {{ authentication_method_form.csrf_token() }}
                       <input class="form-control" type="hidden" name="{{authentication_method_form.id.name}}" value={{authentication.id}}>
                       {% if error %} <span class='help-block'>{{error}} </span> {%endif%}
                       {% if authentications|length > 1 %}
                          {% if confirmed_authentication_methods > 1 %}
                             {% if authentication.type.name.lower() not in ('ldap', 'fido2_passkey', 'federated_login', 'oidc') %}
                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#pwModal{{authentication.id}}"><i class="fa fa-edit" aria-hidden="true"></i></button>
                             {% endif %}
                             {% if authentication.type.name.lower() != 'federated_login' %}
                               <button type="submit" class="btn btn-danger" name="remove" value="Remove"><i class="fa fa-times" aria-hidden="true"></i></button>
                             {% else %}
                               <button type="submit" class="btn btn-danger" name="remove" value="Remove" data-toggle="tooltip" data-placement="top" title="{{ _('To remove this authentication method, revoke the corresponding federated identity.') }}" disabled><i class="fa fa-times" aria-hidden="true"></i></button>
                             {% endif %}
                          {% else %}
                               {% if authentication.confirmed  %}
                                 {% if authentication.type.name.lower() not in ('ldap', 'fido2_passkey', 'federated_login', 'oidc') %}
                                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#pwModal{{authentication.id}}"><i class="fa fa-edit" aria-hidden="true"></i></button>
                                 {% endif %}
                                 <button type="submit" class="btn btn-danger" name="remove" disabled><i class="fa fa-times" aria-hidden="true"></i></button>
                               {% else %}
                                 <button type="submit" class="btn btn-danger" name="remove" value="Remove"><i class="fa fa-times" aria-hidden="true"></i></button>
                               {% endif %}
                          {% endif %}
                       {% else %}
                         {% if authentication.confirmed and authentication.type.name.lower() not in ('ldap', 'fido2_passkey', 'federated_login', 'oidc') %}
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#pwModal{{authentication.id}}"><i class="fa fa-edit" aria-hidden="true"></i></button>
                         {% endif %}
                         <button type="submit" class="btn btn-danger" name="remove" disabled><i class="fa fa-times" aria-hidden="true"></i></button>
                       {% endif %}
                   </form>
              </td>
           </tr>
           {% endif %}
           {% endfor %}
         </tbody>
         {% if not is_oidc_only_auth_method %}
          <tfoot>
            <tr>
              <td></td>
              <td></td>
              <td class="text-right"><button type="button" class="btn btn-success" data-toggle="modal" data-target="#addAuthenticationMethodModal"><i class="fa fa-plus" aria-hidden="true"></i></button></td>
            </tr>
          </tfoot>
         {% endif %}
       </table>
    </div>

  <h3 id="api_tokens">{{ _('API Tokens')}}</h3>
  <div>
    <p>
      <strong>{{ _('Note:')}}</strong> {{ _('API tokens are an authentication method for use with the <a href="https://scientific-it-systems.iffgit.fz-juelich.de/SampleDB/developer_guide/api.html">HTTP API</a>.')}}
    </p>
    <table class="table">
      {% if api_tokens %}
         <thead>
             <tr>
                 <th>{{ _('Description') }}</th>
                 <th></th>
                 <th></th>
             </tr>
         </thead>
         <tbody>
           {% for authentication in api_tokens %}
           <tr>
             <td>{{ authentication.login['description'] }}</td>
             <td><a href="{{ url_for('.current_user_api_log', api_token_id=authentication.id) }}">{{ _('View Log')}}</a></td>
             <td class="text-right">
               <form method="post" name="form-remove-authentication-methods" action="{{ url_for('.user_preferences', user_id=current_user.id) }}">
                 {{ authentication_method_form.csrf_token() }}
                 <input class="form-control" type="hidden" name="{{authentication_method_form.id.name}}" value={{authentication.id}}>
                 <button type="submit" class="btn btn-danger" name="remove" value="Remove"><i class="fa fa-times" aria-hidden="true"></i></button>
               </form>
             </td>
           </tr>
           {% endfor %}
         </tbody>
      {% endif %}
       <tfoot>
         <tr>
           <td></td>
           <td></td>
           <td class="text-right"><button type="button" class="btn btn-success" data-toggle="modal" data-target="#createApiTokenModal"><i class="fa fa-plus" aria-hidden="true"></i></button></td>
         </tr>
       </tfoot>
    </table>
  </div>

  {% if api_access_tokens %}
  <h3 id="api_access_tokens">{{ _('API Access Tokens')}}</h3>
  <div>
    <p>
      <strong>{{ _('Note:')}}</strong> {{ _('API access tokens are short-lived tokens for the use by interactive applications or scripts to authenticate with the <a href="https://scientific-it-systems.iffgit.fz-juelich.de/SampleDB/developer_guide/api.html">HTTP API</a>.')}}
    </p>
    <table class="table">
      <thead>
        <tr>
          <th>{{ _('Description') }}</th>
          <th>{{ _('Expiration Datetime') }}</th>
          <th style="width:1%"></th>
          <th style="width:1%"></th>
        </tr>
      </thead>
      <tbody>
       {% for authentication in api_access_tokens %}
       <tr>
         <td>{{ authentication.login['description'] }}</td>
         <td>{{ authentication.login['expiration_utc_datetime'] | babel_format_datetime }}</td>
         <td style="white-space: nowrap"><a href="{{ url_for('.current_user_api_log', api_token_id=authentication.id) }}">{{ _('View Log')}}</a></td>
         <td class="text-right">
           <form method="post" name="form-remove-authentication-methods" action="{{ url_for('.user_preferences', user_id=current_user.id) }}">
             {{ authentication_method_form.csrf_token() }}
             <input class="form-control" type="hidden" name="{{authentication_method_form.id.name}}" value={{authentication.id}}>
             <button type="submit" class="btn btn-danger" name="remove" value="Remove"><i class="fa fa-times" aria-hidden="true"></i></button>
           </form>
         </td>
       </tr>
       {% endfor %}
     </tbody>
    </table>
  </div>
  {% endif %}

  <h3 id="2fa">{{ _('Two-Factor Authentication') }}</h3>
  {% if two_factor_authentication_methods %}
  <table class="table">
    <thead>
      <tr>
        <th>{{ _('Description') }}</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
    {% for method in two_factor_authentication_methods %}
      <tr>
        <td>
          {% if method.data.description %}
            <em>{{ method.data.description }}</em>
          {% elif method.data.type == 'totp' %}
            {{ _('TOTP-based Two-Factor Authentication') }}
          {% elif method.data.type == 'fido2_passkey' %}
            {{ _('FIDO2 Passkey') }}
          {% else %}
            {{ _('Unknown Two-Factor Authentication Method') }}
          {% endif %}
        </td>
        <td style="width: 1%; white-space: nowrap;">
          <form method="post">
            {{ manage_two_factor_authentication_method_form.hidden_tag() }}
            <input type="hidden" name="{{ manage_two_factor_authentication_method_form.method_id.name }}" value="{{ method.id }}">
      {% if method.active %}
            <button type="submit" class="btn btn-default" style="min-width:8em" name="{{ manage_two_factor_authentication_method_form.action.name }}" value="disable">{{ _('Disable') }}</button>
      {% else %}
            <button type="submit" class="btn btn-default" style="min-width:8em" name="{{ manage_two_factor_authentication_method_form.action.name }}" value="enable">{{ _('Enable') }}</button>
      {% endif %}
            <button type="submit" class="btn btn-danger" style="min-width:8em" name="{{ manage_two_factor_authentication_method_form.action.name }}" value="delete" {% if method.active %}disabled="disabled" data-toggle="tooltip" data-placement="top" title="{{ _('Disable this method before deleting it.') }}"{% endif %}>{{ _('Delete') }}</button>
          </form>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  {% endif %}
  <div class="text-right">
    <a href="{{ url_for('.setup_totp_two_factor_authentication') }}" class="btn btn-success">{{ _('Set up TOTP-based Two-Factor Authentication') }}</a>
    <a href="{{ url_for('.setup_fido2_passkey_two_factor_authentication') }}" class="btn btn-success">{{ _('Set up FIDO2 Passkey for Two-Factor Authentication') }}</a>
  </div>

  {% if may_use_webhooks %}
    <h3 id="webhooks">{{ _('Webhooks') }}</h3>
    <div>
      <p>
        <strong>{{ _('Note:')}}</strong> {{ _('Webhooks allow you to subscribe to the object log, as described in <a href="https://scientific-it-systems.iffgit.fz-juelich.de/SampleDB/developer_guide/webhooks.html">the documentation</a>.')}}
      </p>
        <table class="table">
      {% if webhooks | length == 0 %}
        {{ _('You have not yet created any webhooks.') }}
      {% else %}
         <thead>
             <tr>
                 <th>{{ _('Name') }}</th>
                 <th>{{ _('Address') }}</th>
                 <th>{{ _('Last Contact') }}</th>
                 <th></th>
             </tr>
         </thead>
         <tbody>
           {% for webhook in webhooks %}
           <tr>
             <td>{{ webhook.name or '—' }}</td>
             <td>{{ webhook.target_url }}</td>
             <td>{% if not webhook.last_contact %}&mdash;{% else %}{{ webhook.last_contact }}{% endif %}</td>
             <td class="text-right">
               <div class="btn-group">
                 <form method="post" name="form-remove-webhook" action="{{ url_for('.user_preferences', user_id=current_user.id) }}">
                   {{ remove_webhook_form.csrf_token() }}
                   <input class="form-control" type="hidden" name="{{remove_webhook_form.id.name}}" value={{webhook.id}}>
                   <button type="submit" class="btn btn-danger" name="remove_webhook" value="remove"><i class="fa fa-times" aria-hidden="true"></i> {{ _('Remove') }}</button>
                 </form>
               </div>
             </td>
           </tr>
           {% endfor %}
         </tbody>
      {% endif %}
         <tfoot>
           <tr>
             <td></td>
             <td></td>
             <td></td>
             <td class="text-right"><button type="button" class="btn btn-success" data-toggle="modal" data-target="#addWebhookModal"><i class="fa fa-plus" aria-hidden="true"></i> {{ _('Add Webhook') }}</button></td>
           </tr>
         </tfoot>
      </table>
    </div>
  {% endif %}

  <h2 id="notification_settings">{{ _('Notification Settings')}}</h2>
  <p><strong>{{ _('Note:')}}</strong>
    {{ _('%(service_name)s will notify you about various events. By default, these notifications will be sent using the %(service_name)s notification system, but you can also chose to receive them via email or decide to ignore some notification types.', service_name=service_name) }}</p>

  <form action="{{ url_for('.user_preferences', user_id=current_user.id) }}" method="post">
    {{ notification_mode_form.csrf_token }}
    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col" style="width: 40%">{{ _('Notification Type')}}</th>
          <th scope="col" class="text-center">{{ _('Ignore') }}</th>
          <th scope="col" class="text-center">{{ _('Web') }}</th>
          <th scope="col" class="text-center">{{ _('Email') }}</th>
      </thead>
      <tbody>
        {% set notification_types = {
              NotificationType.ANNOUNCEMENT: (_("Announcements"), False),
              NotificationType.ASSIGNED_AS_RESPONSIBLE_USER: (_("Becoming responsible for an object"), True),
              NotificationType.RESPONSIBILITY_ASSIGNMENT_DECLINED: (_("Responsibility for an object being declined"), True),
              NotificationType.INVITED_TO_GROUP: (_("Being invited to a basic group"), False),
              NotificationType.INVITED_TO_PROJECT: (_("Being invited to a project group"), False),
              NotificationType.RECEIVED_OBJECT_PERMISSIONS_REQUEST: (_("Receiving object permission requests"), False),
              NotificationType.INSTRUMENT_LOG_ENTRY_CREATED: (_("Receiving a new instrument log entry"), True),
              NotificationType.INSTRUMENT_LOG_ENTRY_EDITED: (_("Receiving an edit to an instrument log"), True),
              NotificationType.REFERENCED_BY_OBJECT_METADATA: (_("Being referenced in object metadata"), True),
              NotificationType.REMOTE_OBJECT_IMPORT_FAILED: (_("Failure of importing an object into another database"), False),
              NotificationType.REMOTE_OBJECT_IMPORT_NOTES: (_("Receiving notes after importing an object into another database"), True),
              NotificationType.AUTOMATIC_USER_FEDERATION: (_("Being automatically linked with a user from another database"), True),
              NotificationType.OTHER: (_("Other"), False)
            }
        %}
        {% set instrument_related_notification_types = [NotificationType.INSTRUMENT_LOG_ENTRY_CREATED, NotificationType.INSTRUMENT_LOG_ENTRY_EDITED]%}
        {% for notification_type in notification_types %}
          {% set notification_description = notification_types[notification_type][0] %}
          {% set notification_can_be_ignored = notification_types[notification_type][1] %}
          {% if notification_type not in instrument_related_notification_types or is_instrument_responsible_user %}
          <tr>
            <td style="vertical-align: middle">{{ notification_description }}</td>
            {% for notification_mode in [NotificationMode.IGNORE, NotificationMode.WEBAPP, NotificationMode.EMAIL] %}
            <td class="text-center" style="vertical-align: middle">
              {% if notification_mode != NotificationMode.IGNORE or notification_can_be_ignored or notification_modes.get(notification_type) == notification_mode%}
                <label for="notification_mode_for_type_{{ notification_type.name.lower() }}_{{ notification_mode.name.lower() }}" class="sr-only">{{ notification_mode.name.lower() }}</label>
                <input type="radio" id="notification_mode_for_type_{{ notification_type.name.lower() }}_{{ notification_mode.name.lower() }}" name="notification_mode_for_type_{{ notification_type.name.lower() }}" class="notification-mode-input-{{ notification_mode.name.lower() }}" value="{{ notification_mode.name.lower() }}" {% if notification_modes.get(notification_type, NotificationMode.WEBAPP) == notification_mode %}checked="checked"{% endif %}/>
              {% endif %}
            </td>
            {% endfor %}
          </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>
    <div class="container">
      <button type="submit" class="btn btn-primary col-md-offset-9 col-md-3" name="edit_notification_settings" value="edit_notification_settings">{{ _('Save') }}</button>
    </div>
  </form>

  <h2 id="default_permissions">{{ _('Default Permissions')}}</h2>
  <p><strong>{{ _('Note:') }}</strong> {{ _('These permissions will be used for objects that you create in the future. To change the permissions for an already existing object, please use the <strong>Edit permissions</strong> button on the object\'s site.') }}</p>

  {% set user_may_edit = not current_user.is_readonly %}
  {% set form_url = url_for('.user_preferences', user_id=current_user.id) %}
  {% set permissions_form = default_permissions_form %}
  {% set fixed_user_permissions = {current_user.id: Permissions.GRANT}  %}
  {% set show_administrators = True %}
  {% set show_instrument_scientists = True %}
  {% set show_all_users = True %}
  {% set read_permissions_description = _('Permission to view objects and their properties, files and comments.') %}
  {% set write_permissions_description = _('Permission to edit objects and their properties and add files and comments. Includes Read permissions.') %}
  {% set grant_permissions_description = _('Permission to grant permissions to other users. Includes Write permissions.') %}
  {% include "permissions/permissions.html" %}

  <h2 id="other_settings">{{ _('Other Settings') }}</h2>
  <form action="{{ url_for('.user_preferences', user_id=current_user.id) }}" method="post" class="form-horizontal">
    {% if user_settings['DATAVERSE_API_TOKEN'] %}
    <div class="form-group">
      <label class="control-label col-md-4">
        {{ _('Dataverse API Token') }}
      </label>
      <input type="submit" name="delete_dataverse_api_token" class="btn btn-danger col-md-offset-5 col-md-3" value="{{ _('Delete Dataverse API Token') }}" />
    </div>
    {% endif %}
  </form>
  <form action="{{ url_for('.user_preferences', user_id=current_user.id) }}" method="post" class="form-horizontal">
    {{ other_settings_form.csrf_token }}
    <div class="form-group">
      <label class="col-md-4 control-label" for="input-use-schema-editor-yes">
        {{ _('Use Schema Editor') }}
      </label>
      <div class="radio col-md-4">
        <label>
          <input type="radio" name="input-use-schema-editor" id="input-use-schema-editor-yes" value="yes" {% if user_settings["USE_SCHEMA_EDITOR"] %}checked="checked"{% endif %}>
          {{ _('Yes &mdash; Use graphical editor for editing action schemas (recommended)') }}
        </label>
      </div>
      <div class="radio col-md-4">
        <label>
          <input type="radio" name="input-use-schema-editor" id="input-use-schema-editor-no" value="no" {% if not user_settings["USE_SCHEMA_EDITOR"] %}checked="checked"{% endif %}>
          {{ _('No &mdash; Edit schemas as JSON using a text editor (advanced)') }}
        </label>
      </div>
    </div>
    <div class="form-group">
      <label class="col-md-4 control-label" for="input-show-object-type-and-id-on-object-page-yes">
        {{ _('Show object type and id on object page') }}
      </label>
      <div class="radio col-md-8">
        <label>
          <input type="radio" name="input-show-object-type-and-id-on-object-page" id="input-show-object-type-and-id-on-object-page-yes" value="yes" {% if user_settings["SHOW_OBJECT_TYPE_AND_ID_ON_OBJECT_PAGE"] is true %}checked="checked"{% endif %}>
          {{ _('Yes &mdash; Show object type and id, e.g. "Sample #4"') }}
        </label>
      </div>
      <div class="radio col-md-offset-4 col-md-8">
        <label>
          <input type="radio" name="input-show-object-type-and-id-on-object-page" id="input-show-object-type-and-id-on-object-page-no" value="no" {% if user_settings["SHOW_OBJECT_TYPE_AND_ID_ON_OBJECT_PAGE"] is false %}checked="checked"{% endif %}>
          {{ _('No &mdash; Hide object type and id') }}
        </label>
      </div>
      <div class="radio col-md-offset-4 col-md-8">
        <label>
          <input type="radio" name="input-show-object-type-and-id-on-object-page" id="input-show-object-type-and-id-on-object-page-default" value="default" {% if user_settings["SHOW_OBJECT_TYPE_AND_ID_ON_OBJECT_PAGE"] is none %}checked="checked"{% endif %}>
          {{ _('Default &mdash; Use the site-wide default setting') }}
        </label>
      </div>
    </div>
    <div class="form-group">
      <label class="col-md-4 control-label" for="input-show-object-title-yes">
        {{ _('Show object schema titles') }}
      </label>
      <div class="radio col-md-8">
        <label>
          <input type="radio" name="input-show-object-title" id="input-show-object-title-yes" value="yes" {% if user_settings["SHOW_OBJECT_TITLE"] is true %}checked="checked"{% endif %}>
          {{ _('Yes &mdash; Show object schema titles when viewing metadata') }}
        </label>
      </div>
      <div class="radio col-md-8 col-md-offset-4">
        <label>
          <input type="radio" name="input-show-object-title" id="input-show-object-title-no" value="no" {% if user_settings["SHOW_OBJECT_TITLE"] is false %}checked="checked"{% endif %}>
          {{ _('No &mdash; Hide object schema titles when viewing metadata') }}
        </label>
      </div>
      <div class="radio col-md-8 col-md-offset-4">
        <label>
          <input type="radio" name="input-show-object-title" id="input-show-object-title-default" value="default" {% if user_settings["SHOW_OBJECT_TITLE"] is none %}checked="checked"{% endif %}>
          {{ _('Default &mdash; Use the site-wide default setting') }}
        </label>
      </div>
    </div>
    <div class="form-group">
      <label class="col-md-4 control-label" for="input-full-width-objects-table-yes">
        {{ _('Show objects table at full width') }}
      </label>
      <div class="radio col-md-8">
        <label>
          <input type="radio" name="input-full-width-objects-table" id="input-full-width-objects-table-yes" value="yes" {% if user_settings["FULL_WIDTH_OBJECTS_TABLE"] is true %}checked="checked"{% endif %}>
          {{ _('Yes &mdash; Let the objects table be as wide as the browser window') }}
        </label>
      </div>
      <div class="radio col-md-8 col-md-offset-4">
        <label>
          <input type="radio" name="input-full-width-objects-table" id="input-full-width-objects-table-no" value="no" {% if user_settings["FULL_WIDTH_OBJECTS_TABLE"] is false %}checked="checked"{% endif %}>
          {{ _('No &mdash; Limit the objects table to the regular content width') }}
        </label>
      </div>
      <div class="radio col-md-8 col-md-offset-4">
        <label>
          <input type="radio" name="input-full-width-objects-table" id="input-full-width-objects-table-default" value="default" {% if user_settings["FULL_WIDTH_OBJECTS_TABLE"] is none %}checked="checked"{% endif %}>
          {{ _('Default &mdash; Use the site-wide default setting') }}
        </label>
      </div>
    </div>
    <div class="form-group">
      <label class="col-md-4 control-label" for="input-workflow-view-modals-yes">
        {{ _('Show workflow views in popup windows') }}
      </label>
      <div class="radio col-md-8">
        <label>
          <input type="radio" name="input-workflow-view-modals" id="input-workflow-view-modals-yes" value="yes" {% if user_settings["WORKFLOW_VIEW_MODALS"] is true %}checked="checked"{% endif %}>
          {{ _('Yes &mdash; Show workflow views in popup windows.') }}
        </label>
      </div>
      <div class="radio col-md-8 col-md-offset-4">
        <label>
          <input type="radio" name="input-workflow-view-modals" id="input-workflow-view-modals-no" value="no" {% if user_settings["WORKFLOW_VIEW_MODALS"] is false %}checked="checked"{% endif %}>
          {{ _('No &mdash; Show workflow views directly on the object page.') }}
        </label>
      </div>
      <div class="radio col-md-8 col-md-offset-4">
        <label>
          <input type="radio" name="input-workflow-view-modals" id="input-workflow-view-modals-default" value="default" {% if user_settings["WORKFLOW_VIEW_MODALS"] is none %}checked="checked"{% endif %}>
          {{ _('Default &mdash; Use the site-wide default setting') }}
        </label>
      </div>
    </div>
    <div class="form-group">
      <label class="col-md-4 control-label" for="input-workflow-view-collapsed-collapsible">
        {{ _('Collapse objects in workflow views') }}
      </label>
      <div class="radio col-md-8">
        <label>
          <input type="radio" name="input-workflow-view-collapsed" id="input-workflow-view-collapsed-yes" value="yes" {% if user_settings["WORKFLOW_VIEW_COLLAPSED"] %}checked="checked"{% endif %}>
          {{ _('Yes &mdash; Collapse objects in workflow views') }}
        </label>
      </div>
      <div class="radio col-md-8 col-md-offset-4">
        <label>
          <input type="radio" name="input-workflow-view-collapsed" id="input-workflow-view-collapsed-no" value="no" {% if not user_settings["WORKFLOW_VIEW_COLLAPSED"] %}checked="checked"{% endif %}>
          {{ _('No &mdash; Expand objects in workflow views') }}
        </label>
      </div>
      <div class="radio col-md-8 col-md-offset-4">
        <label>
          <input type="radio" name="input-workflow-view-collapsed" id="input-workflow-view-collapsed-default" value="default" {% if user_settings["WORKFLOW_VIEW_COLLAPSED"] is none %}checked="checked"{% endif %}>
          {{ _('Default &mdash; Use the site-wide default setting') }}
        </label>
      </div>
    </div>
    <div class="form-group">
      <label class="col-md-4 control-label" for="select-locale">
        {{ _('Language') }}
      </label>
      <span class="col-md-8">
        <select class="selectpicker form-control" id="select-locale" name="select-locale" data-width="100%" data-live-search="true">
        <option value="auto_lc" {% if  user_settings['AUTO_LC'] == True or user_settings['LOCALE'] not in allowed_language_codes %} selected {% endif %}>{{ _('Detect language (default): ') }} {{ your_locale }}  </option>
        {% for locale in supported_locales %}
          {% if locale in allowed_language_codes %}
            <option value="{{ locale }}" {% if  user_settings['LOCALE'] ==  locale and user_settings['AUTO_LC'] == False%} selected {% endif %}>{{ supported_locales[locale].native_name }} ({{ locale }})</option>
          {% endif %}
        {% endfor %}
        </select>
      </span>
    </div>

    {% if not config['TIMEZONE'] %}
    <input type="text" hidden id="timezone" value="" name="timezone">

    <div class="form-group">
      <label class="col-md-4 control-label" for="select-timezone">
        {{ _('Time Zone') }}
      </label>
        <span class="col-md-8">
          <select class="selectpicker form-control" id="select-timezone" name="select-timezone" data-width="100%" data-live-search="true">
          <option value="auto_tz" id="auto_tz" {% if  user_settings['AUTO_TZ'] ==  True %} selected {% endif %}> {{ _('Detect time zone (default): ') }} &mdash; </option>
          {% for tz in all_timezones %}
              <option value="{{ tz }}" {% if  user_settings['TIMEZONE'] ==  tz and user_settings['AUTO_TZ'] == False%} selected {% endif %}> {{ tz }}</option>
          {% endfor %}
          </select>
      </span>
    </div>
    {% endif %}
    <div class="form-group">
      <label class="col-md-4 control-label" for="input-objects-per-page">
        {{ _('Objects per Page') }}
      </label>
      <span class="col-md-8">
        <select class="selectpicker form-control" id="input-objects-per-page" name="input-objects-per-page">
          {% for limit in (10, 25, 50, 100, 'all') %}
          <option value="{{ limit }}" {% if limit == user_settings['OBJECTS_PER_PAGE'] or (limit == 'all' and user_settings['OBJECTS_PER_PAGE'] is none) %}selected="selected"{% endif %}>{% if limit == 'all' %}{{ _('all') }}{% else %}{{ limit }}{% endif %}</option>
          {% endfor %}
        </select>
      </span>
    </div>
    {% if current_user.is_admin %}
  <h2 id="administrator_settings">{{ _('Administrator Settings') }}</h2>
    <div class="form-group">
      <label class="col-md-4 control-label" for="input-use-admin-permissions-yes">
        {{ _('Use Admin Permissions') }}
      </label>
      <div class="radio col-md-4">
        <label>
          <input type="radio" name="input-use-admin-permissions" id="input-use-admin-permissions-yes" value="yes" {% if user_settings["USE_ADMIN_PERMISSIONS"] %}checked="checked"{% endif %}>
          {{ _('Yes &mdash; Always use <b>GRANT</b> permissions') }}
        </label>
      </div>
      <div class="radio col-md-4">
        <label>
          <input type="radio" name="input-use-admin-permissions" id="input-use-admin-permissions-no" value="no" {% if not user_settings["USE_ADMIN_PERMISSIONS"] %}checked="checked"{% endif %}>
          {{ _('No &mdash; Use regular permission system') }}
        </label>
      </div>
    </div>
    <div class="form-group">
      <label class="col-md-4 control-label" for="input-show-invitation-log-yes">
        {{ _('Show full invitation log for basic and project groups') }}
      </label>
      <div class="radio col-md-4">
        <label>
          <input type="radio" name="input-show-invitation-log" id="input-show-invitation-log-yes" value="yes" {% if user_settings["SHOW_INVITATION_LOG"] %}checked="checked"{% endif %}>
          {{ _('Yes &mdash; Show all past invitations') }}
        </label>
      </div>
      <div class="radio col-md-4">
        <label>
          <input type="radio" name="input-show-invitation-log" id="input-show-invitation-log-no" value="no" {% if not user_settings["SHOW_INVITATION_LOG"] %}checked="checked"{% endif %}>
          {{ _('No &mdash; Only show pending invitations') }}
        </label>
      </div>
    </div>
    <div class="form-group">
      <label class="col-md-4 control-label" for="input-show-hidden-users-as-admin-yes">
        {{ _('Show hidden users in user lists') }}
      </label>
      <div class="radio col-md-4">
        <label>
          <input type="radio" name="input-show-hidden-users-as-admin" id="input-show-hidden-users-as-admin-yes" value="yes" {% if user_settings["SHOW_HIDDEN_USERS_AS_ADMIN"] %}checked="checked"{% endif %}>
          {{ _('Yes &mdash; Show hidden users in user lists') }}
        </label>
      </div>
      <div class="radio col-md-4">
        <label>
          <input type="radio" name="input-show-hidden-users-as-admin" id="input-show-hidden-users-as-admin-no" value="no" {% if not user_settings["SHOW_HIDDEN_USERS_AS_ADMIN"] %}checked="checked"{% endif %}>
          {{ _('No &mdash; Hide hidden users in user lists') }}
        </label>
      </div>
    </div>
    {% endif %}
    <div class="form-group">
      <button type="submit" class="btn btn-primary col-md-offset-9 col-md-3" name="edit_other_settings" value="edit_other_settings">{{ _('Save') }}</button>
    </div>
  </form>

<!-- Modal -->
<div class="modal fade" id="addAuthenticationMethodModal" tabindex="-1" role="dialog" aria-labelledby="addAuthenticationMethodModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form class="form-horizontal" id="form-add-authentication-methods" method="post" name="form-add-authentication-methods" action="{{ url_for('.user_preferences', user_id=current_user.id) }}">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="{{ _('Close') }}"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="addAuthenticationMethodModalLabel">{{ _('Add Authentication Method') }}</h4>
      </div>
      <div class="modal-body">
            {{ authentication_form.hidden_tag() }}
            <div class="form-group">
                <label class="col-sm-4 control-label">{{ _('Type') }}</label>
                <div class="col-sm-8">
                  <select class="form-control selectpicker" name="{{ authentication_form.authentication_method.name }}" id="addAuthenticationMethodTypeSelect">
                  {% for option in authentication_form.authentication_method.choices %}
                    <option value="{{ option[0] }}"{% if authentication_form.authentication_method.data == option[0] %}selected="selected"{% endif %}>{{ {'ldap': 'LDAP', 'email': _('Email'), 'fido2 passkey': _('FIDO2 Passkey'), 'other': _('Other')}[option[1].lower()] }}</option>
                  {% endfor %}
                  </select>
                  <span class='help-block'></span>
                </div>
            </div>
            <div class="form-group{% if authentication_form.login.errors  or error_add %} has-error{% endif %}" id="addAuthenticationMethodLoginGroup">
                <label for="input-login" class="col-sm-4 control-label">{{ _('Username / Email') }}</label>
                <div class="col-sm-8">
                    <input class="form-control" type="text" id="input-login" name="login" minlength="1" placeholder="{{ _('Username / Email') }}" {% if authentication_form.login.data %}value="{{ authentication_form.login.data }}"{% endif %}>
                    {% if error_add %} <span class='help-block'>{{error_add}} </span> {%endif%}
                    {% if error %} <span class='help-block'>{{error}} </span> {%endif%}
                </div>
            </div>
            <div class="form-group{% if authentication_form.password.errors%} has-error {% endif %}" id="addAuthenticationMethodPasswordGroup">
                <label for="input-password" class="col-sm-4 control-label">{{ _('Password') }}</label>
                <div class="col-sm-8">
                     <input class="form-control" type="password" id="input-password" name="password" minlength="3" placeholder="{{ _('Password') }}">
                    {% for error in authentication_form.password.errors %}
                      <span class='help-block'>{{ error }}</span>
                    {% endfor %}
                </div>
            </div>
            <div class="form-group{% if authentication_form.description.errors  or error_add %} has-error{% endif %}" id="addAuthenticationMethodDescriptionGroup">
                <label for="input-passkey-description" class="col-sm-4 control-label">{{ _('Description') }}</label>
                <div class="col-sm-8">
                    <input class="form-control" type="text" id="input-passkey-description" name="description" minlength="1" placeholder="{{ _('Description') }}" {% if authentication_form.description.data %}value="{{ authentication_form.description.data }}"{% endif %}>
                    {% if error_add %} <span class='help-block'>{{error_add}} </span> {%endif%}
                    {% if error %} <span class='help-block'>{{error}} </span> {%endif%}
                  <span class='help-block'></span>
                  <div class="text-muted">{{ _('Note:') }} {{ _('When signing in with a FIDO2 Passkey, %(service_name)s will <strong>not</strong> use any additional two-factor authentication methods configured in your preferences.', service_name=service_name) }}</div>
                </div>
            </div>
      </div>
      <div class="modal-footer">
        <input type="hidden" name="add" value="Add" />
        <button type="button" class="btn btn-default" data-dismiss="modal" style="width:7em;">{{ _('Cancel') }}</button>
        <button type="submit" class="btn btn-primary" style="width:7em;">{{ _('Add') }}</button>
      </div>
      </form>
    </div>
  </div>
</div>
{% for authentication in authentications %}
<div class="modal fade" id="pwModal{{authentication.id}}" tabindex="-1" role="dialog" aria-labelledby="pwModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form class="form-horizontal" id="form-change-password" method="post" name="form-change-password" action="{{ url_for('.user_preferences', user_id=current_user.id) }}">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="{{ _('Close') }}"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="pwModalLabel">{{ _('Change Password') }}</h4>
      </div>
      <div class="modal-body">
            {{ authentication_password_form.csrf_token() }}
            <input class="form-control" type="hidden" name="{{authentication_password_form.id.name}}" value={{authentication.id}}>
            <div class="form-group{% if authentication_password_form.password.errors%} has-error {% endif %}">
                <label for="input-pw" class="col-sm-4 control-label">{{ _('Password') }}</label>
                <div class="col-sm-8">
                     <input class="form-control" type="password" id="input-pw" name="password"  placeholder="{{ _('Password') }}">
                    {% for error in authentication_password_form.password.errors %}
                      <span class='help-block'>{{ error }}</span>
                    {% endfor %}
                </div>
            </div>
            <div class="form-group{% if authentication_password_form.password_confirmation.errors%} has-error {% endif %}">
                <label for="input-pw-confirmation" class="col-sm-4 control-label">{{ _('Confirm Password') }}</label>
                <div class="col-sm-8">
                     <input class="form-control" type="password" id="input-pw-confirmation" name="{{ authentication_password_form.password_confirmation.name }}"  placeholder="{{ _('Confirm Password') }}">
                    {% if authentication_password_form.password_confirmation.errors %}
                     <span class='help-block'>{{ _('Please enter the same password as above.') }}</span>
                    {% endif %}
                </div>
            </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" style="width:7em;">{{ _('Cancel') }}</button>
        <button type="submit" class="btn btn-primary" name="edit" value="Edit" style="width:7em;">{{ _('Change') }}</button>
      </div>
      </form>
    </div>
  </div>
</div>
{% endfor %}

<div class="modal fade" id="createApiTokenModal" tabindex="-1" role="dialog" aria-labelledby="createApiTokenModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form class="form-horizontal" id="form-add-api-token" method="post" name="form-add-api-token" action="{{ url_for('.user_preferences', user_id=current_user.id) }}">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="{{ _('Close') }}"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="createApiTokenModalLabel">{{ _('Create API Token') }}</h4>
      </div>
      <div class="modal-body">
            {{ create_api_token_form.csrf_token() }}
            <div class="form-group{% if create_api_token_form.description.errors %} has-error{% endif %}">
                <label for="input-description" class="col-sm-4 control-label">{{ _('Description') }}</label>
                <div class="col-sm-8">
                    <input class="form-control" type="text" id="input-description" name="description"  placeholder="{{ _('Description') }}" {% if create_api_token_form.description.data %}value="{{ create_api_token_form.description.data }}"{% endif %}>
                    {% if create_api_token_form.description.errors %} <span class='help-block'>{{ _('Please enter a description for the API token.') }}</span> {%endif%}
                </div>
            </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" style="width:7em;">{{ _('Cancel') }}</button>
        <button type="submit" class="btn btn-primary" name="create_api_token" value="create_api_token" style="width:7em;">{{ _('Create') }}</button>
      </div>
      </form>
    </div>
  </div>
</div>

{% if created_api_token %}
<div class="modal fade" id="viewApiTokenModal" tabindex="-1" role="dialog" aria-labelledby="viewApiTokenModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="{{ _('Close') }}"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="viewApiTokenModalLabel">{{ _('New API Token') }}</h4>
      </div>
      <div class="modal-body">
        <div id="api-token">
          <div class="input-group">
            <input type="text" readonly="readonly" class="disabled form-control" value="{{ created_api_token }}"/>
            <span class="input-group-btn">
              <button class="btn btn-default" type="button"><i class="fa fa-clipboard" aria-hidden="true"></i></button>
            </span>
          </div>
          <span class="help-block" id="api-token-copy-notes"></span>
        </div>
        <span class="help-block">{{ _('Make sure you save it &mdash; you won\'t be able to access it again.') }}</span>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" style="width:6em;">{{ _('Close') }}</button>
      </div>
    </div>
  </div>
</div>
{% endif %}

{% if may_use_webhooks %}
  <div class="modal fade" id="addWebhookModal" tabindex="-1" role="dialog" aria-labelledby="addWebhookModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="{{ _('Close') }}"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="addWebhookModalLabel">{{ _('Add Webhook') }}</h4>
        </div>
        <form method="post" action="{{ url_for('.user_preferences', user_id=current_user.id) }}" class="form-horizontal">
          {{ add_webhook_form.csrf_token() }}
          <div class="modal-body">
            <div class="form-group {% if add_webhook_form.name.errors %}has-error{% endif %}">
              <label for="addWebhookName" class="col-sm-2 control-label">{{ _('Name') }}</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="addWebhookName" name="{{ add_webhook_form.name.name }}" placeholder="{{ _('Name') }}" value="{{ add_webhook_form.name.data }}">
                {% for error_message in add_webhook_form.name.errors %}<span class="help-block">{{ error_message }}</span>{% endfor %}
              </div>
            </div>
            <div class="form-group {% if add_webhook_form.address.errors %}has-error{% endif %}">
              <label for="addWebhookTarget" class="col-sm-2 control-label">{{ _('Target Address') }}</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="addWebhookTarget" name="{{ add_webhook_form.address.name }}" placeholder="{{ _('Target Address') }}" value="{{ add_webhook_form.address.data }}">
                {% for error_message in add_webhook_form.address.errors %}<span class="help-block">{{ error_message }}</span>{% endfor %}
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">{{ _('Cancel') }}</button>
            <button type="submit" class="btn btn-primary" name="add_webhook" value="add">{{ _('Create Webhook') }}</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  {% if webhook_secret %}
    <div class="modal fade" id="viewWebhookSecretModal" tabindex="-1" role="dialog" aria-labelledby="viewWebhookSecretModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="{{ _('Close') }}"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="viewWebhookSecretModalLabel">{{ _('New Webhook Secret') }}</h4>
          </div>
          <div class="modal-body">
            <div id="webhook-secret">
              <div class="input-group">
                <input type="text" readonly="readonly" class="disabled form-control" value="{{ webhook_secret }}"/>
                <span class="input-group-btn">
                  <button class="btn btn-default" type="button"><i class="fa fa-clipboard" aria-hidden="true"></i></button>
                </span>
              </div>
              <span class="help-block" id="webhook-secret-copy-notes"></span>
            </div>
            <span class="help-block">
              {{ _('Make sure you save it &mdash; you won\'t be able to access it again.') }}
              {{ _('See the <href="https://scientific-it-systems.iffgit.fz-juelich.de/SampleDB/developer_guide/webhooks.html#validation">documentation</a> on how to use and validate messages using a secret.') }}
            </span>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal" style="width:6em;">{{ _('Close') }}</button>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
{% endif %}

{% endblock %}

{% block template_values %}
  {% do set_template_value("fido2_options", dict(options)) %}
  {% do set_template_value("translations.passkey_failed", _('The passkey failed to register with the following error: ')) %}
  {% do set_template_value("translations.enter_at_least_1_character", _('Please enter at least 1 character.')) %}
  {% do set_template_value("translations.copied", _('Copied!')) %}
  {% do set_template_value("translations.could_not_copy", _('Could not copy to clipboard, please use Ctrl+C.')) %}
  {% do set_template_value("config.timezone_not_set", not config['TIMEZONE']) %}
  {% do set_template_value("has_created_api_token", created_api_token is not none) %}
  {% do set_template_value("show_api_token_modal", create_api_token_form.description.errors | length > 0) %}
  {% do set_template_value("show_add_authentication_method_form", True if 'add' in request.form and (error_add or authentication_form.errors) else False) %}
  {% do set_template_value("show_edit_authentication_method_password_form", "pwModal" + (authentication_password_form.id.data | string) if 'edit' in request.form and authentication_password_form.errors else False) %}
  {% do set_template_value("show_add_webhook_form", show_add_form) %}
  {% do set_template_value("has_created_webhook_secret", webhook_secret is not none) %}

  {{ super() }}
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="{{ fingerprinted_static('bootstrap-select/js/bootstrap-select.min.js') }}"></script>
    <script src="{{ fingerprinted_static('sampledb/js/treepicker.js') }}" type="module"></script>
    <script src="{{ fingerprinted_static('sampledb/js/page/preferences.js') }}" type="module"></script>
{% endblock %}

{% block stylesheets %}
  {{ super() }}
  <link rel="stylesheet" href="{{ fingerprinted_static('bootstrap-select/css/bootstrap-select.min.css') }}" />
{% endblock %}
